#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Ejecutando validaciones pre-commit..."

# Verificar formato de c√≥digo
echo "üìù Verificando formato con Prettier..."
npm run format:check || {
  echo "‚ùå Errores de formato detectados. Ejecuta 'npm run format' para corregir."
  exit 1
}

# Verificar linting
echo "üîç Ejecutando ESLint..."
npm run lint || {
  echo "‚ùå Errores de linting detectados. Ejecuta 'npm run lint:fix' para corregir."
  exit 1
}

# Ejecutar tests
echo "üß™ Ejecutando tests..."
npm test || {
  echo "‚ùå Tests fallaron. Corrige los errores antes de hacer commit."
  exit 1
}

# Verificar que no hay archivos .env en el commit
if git diff --cached --name-only | grep -E "\.env$"; then
  echo "‚ùå Archivo .env detectado en el commit. Remu√©velo del staging area."
  exit 1
fi

# Verificar que no hay console.log en archivos de producci√≥n
if git diff --cached --name-only | grep -E "\.(js|ts)$" | xargs grep -l "console\.log" 2>/dev/null; then
  echo "‚ö†Ô∏è  console.log detectado en archivos. Considera usar el sistema de logging."
  echo "   Contin√∫a? (y/N)"
  read -r response
  if [[ ! "$response" =~ ^[Yy]$ ]]; then
    exit 1
  fi
fi

echo "‚úÖ Todas las validaciones pasaron. Procediendo con el commit..."